{% extends "base.html" %} {% block title %}Results{% endblock %} {% block
    content %}

<style>
  table {
    border-collapse: collapse;
    width: 100%;
  }

  th,
  td {
    text-align: left;
    padding: 8px;
  }

  h3 {
    padding: 10px;
    background-color: #f2f2f2;
  }

  #title {
    display: flex;
    position: relative;
  }

  button {
    position: absolute;
    top: 10px;
    right: 0;
  }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>

<body>
  <div class="container">
    <div class id="title">
      <h1>{{snp}}</h1>
      <button onclick="javascript:window.history.back();">Go Back</button>
      <!-- <button href="/home">Previous SNP</button> -->
      <!-- <button href="/home">Next SNP</button> -->
    </div>
    <p>Gene: {{gene}}</p>
    <P>Chromosome: {{chr}}</P>
    <p>Genotype: {{genotype}}</p>
    <h3>Substitutions and Frequencies</h3>

    <div id="canvas-holder" style="background-color:#FFFFFF;width:50%;float: left;">
      <canvas id="chart1" width="20" height="10" style="float:left;margin-left:2em;margin-bottom:2em"></canvas></div>
    <div id="canvas-holder" style="background-color:#FFFFFF;width:50%;float: right;">
      <canvas id="chart2" width="20" height="10" style="float:right;margin-right:2em;margin-bottom:2em"></canvas></div>

    <script>
      var nuc_num = '{{subs[1]| tojson}}'.slice(1,-1).split(', ');
      var nuc_label = '{{subs[0]| tojson}}'.slice(1,-1).split(', ');
      
      var colors = ["#351f39", "#726a95", "#719fb0", "#a0c1b8"];
      var chart1 = new Chart(document.getElementById("chart1"), {
        type: 'polarArea',
        data: {
          labels: nuc_label,
          datasets: [{
            backgroundColor: colors,
            data: nuc_num
          }]
        },
        options: {
          title: {
            display: true,
            text: 'Nucleotide Substitutions'
          },
          legend: {
            position: 'left'
          }
        }
      });
      var aa_num = '{{subs[3]| tojson}}'.slice(1,-1).split(', ');
      var aa_label = '{{subs[2]| tojson}}'.slice(1,-1).split(', ');
      
      var chart2 = new Chart(document.getElementById("chart2"), {
        type: 'polarArea',
        data: {
          labels: aa_label,
          datasets: [{
            backgroundColor: colors,
            data: aa_num
          }]
        },
        options: {
          title: {
            display: true,
            text: 'Amino acid Substitutions'
          },
          legend: {
            position: 'right'
          }
        }
      });
    </script>
    <div style="background-color:#FFFFFF;width:50%;float: left;">
      <canvas id="pie1" width="20" height="10" style="float:left;margin-left:2em;margin-bottom:2em"></canvas></div>
    <div style="background-color:#FFFFFF;width:50%;float: right;">
      <canvas id="pie2" width="20" height="10" style="float:right;margin-right:2em;margin-bottom:2em"></canvas></div>

    <script>
      var fraction1 = parseFloat('{{ freq1000g[3:] }}')
      var fraction2 = parseFloat('{{ freqhapmap[3:] }}')
      var colors = ['#8b5e83','#d6b0b1'];
      var pie1 = new Chart(document.getElementById("pie1"), {
        type: 'pie',
        data: {
          labels: ['{{ freq1000g[0] }}', "Other"],
          datasets: [{
            backgroundColor: colors,
            data: [fraction1, 1 - fraction1]
          }]
        },
        options: {
          title: {
            display: true,
            text: '1000 Genomes Project'
          },
          legend: {
            position: 'left'
          }
        }
      });
      var pie2 = new Chart(document.getElementById("pie2"), {
        type: 'pie',
        data: {
          labels: ['{{ freqhapmap[0] }}', "Other"],
          datasets: [{
            backgroundColor: colors,
            data: [fraction2, 1 - fraction2]
          }]
        },
        options: {
          title: {
            display: true,
            text: 'HapMap Project'
          },
          legend: {
            position: 'right'
          }
        }
      });
    </script>
  

    <h3>Change in binding affinity (∆∆G)</h3>
    <p>Calculated with {{pdbselect}} and {{aa1}}</p>
    <table id="example" class="display" style="width:100%">
      <tr>
        <th>Program</th>
        <th>∆∆G (kcal/mol)</th>
        <th>Effect</th>
      </tr>
      {% for i in range(0, len(ddgresults)-1) %}
      <tr>
        <td>{{ddgresults[i][0]}}</td>
        <td>{{ddgresults[i][1]}}</td>
        <td>{{ddgresults[i][2]}}</td>
      </tr>
      {% endfor %}
      <tr>
        <th>{{ddgresults[len(ddgresults)-1][0]}}</th>
        <th></th>
        <th>{{ddgresults[len(ddgresults)-1][2]}}</th>
      </tr>
    </table>
    <p>* UEP only evaluates mutations located in highly-packed interface positions</p>
  

    

    <h3>Clinical significance</h3>
    {% for item in clin %}
    <ul>
      <li>{{item}}</li>
    </ul>
    {% endfor %}
    <h3>Protein viewer</h3>
    <p>The specific areas (if any) that the {{gene}} protein is affected by {{snp}} in {{pdbselect}} is shown in purple.
    </p>
    <div>

      <script src="https://cdn.rawgit.com/arose/ngl/v0.10.4-1/dist/ngl.js "></script>

      <script>
        var pdbfile = '{{ pdbselect }}';
        var rscb = "rcsb://";
        var input = rscb.concat(pdbfile);
        var chain = ':{{chain}}';
        document.addEventListener("DOMContentLoaded", function () {
          var stage = new NGL.Stage("viewport", {
            backgroundColor: 'white'
          });
          var schemeId = NGL.ColormakerRegistry.addSelectionScheme([
            ["purple", chain],
            ["grey", "*"]
          ])
          stage.loadFile(input).then(function (o) {
            o.addRepresentation("ribbon", {
              colorScheme: schemeId
            });
            o.autoView();
          });
        });
      </script>
      <div id="viewport" style="width:100%; height:300px;"></div>
    </div>

    <h3>PDB files</h3>
    <form action="#" method="post">
      {% for i in pdb %}
      <input type="submit" name="pdbselect" value={{i}}>
      {% endfor %}
    </form>

  </div>
</body>

{% endblock %}